<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="./css/styles.css">
    <title>Signup</title>
    

    <style>
      

    </style>
</head>
<body>
    <!-- ë°°ê²½ ë™ì˜ìƒ -->
    <video autoplay muted loop class="video-background">
        <source src="/assets/money.mp4" type="video/mp4">
        ë™ì˜ìƒ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.
    </video>
<div class="signup-container">
    <h2 th:text="#{signup}">íšŒì›ê°€ì…</h2>
    <p th:if="${errorMessage}" style="color:red;">[[${errorMessage}]]</p>
    <p th:if="${successMessage}" style="color:green;">[[${successMessage}]]</p>
    <form action="/signup" method="post">
        <div style="display: flex; align-items: center;">
            <input type="text" id="username" name="username" th:placeholder="#{ID_placeholder}" style="flex: 1;">
            <button type="button" id="check-username-btn" onclick="checkUsername()" th:text="#{check_duplication}">ì¤‘ë³µí™•ì¸</button>
        </div>
        <div id="username-error" class="error-message"></div>
        <div class="username-requirements" th:text="#{username_requirements}">íŠ¹ìˆ˜ë¬¸ì ì—†ì´ 4ì~20ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.(ì¤‘ë³µí™•ì¸ í•„ìˆ˜)</div>
        <div style="display: flex; align-items: center;">
            <input type="text" id="email_local" name="email_local" th:placeholder="#{email_placeholder}" style="width: 50%; margin-right: 5px;" oninput="validateForm();"> @ 
            <select id="email_domain" name="email_domain" style="width: 50%; margin-left: 5px;" onchange="handleEmailDomainChange();">
                <option value="" th:text="#{select_domain}">ë„ë©”ì¸ ì„ íƒ</option>
                <option value="naver.com">naver.com</option>
                <option value="gmail.com">gmail.com</option>
                <option value="daum.net">daum.net</option>
                <option value="custom" th:text="#{custom_domain}">ì§ì ‘ ì…ë ¥</option>
            </select>
            <input type="text" id="email_domain_custom" name="email_domain_custom" placeholder="ì§ì ‘ ì…ë ¥" style="display: none; width: 50%; margin-left: 5px;" oninput="validateForm();">
        </div>
        <div class="contact-container">
            <label for="phone1" th:text="#{phone}">ì—°ë½ì²˜: </label>
            <input type="text" id="phone1" name="phone1" value="010" readonly style="width: 50px;"> -
            <input type="text" id="phone2" name="phone2" maxlength="4" style="width: 60px;"> -
            <input type="text" id="phone3" name="phone3" maxlength="4" style="width: 60px;">
        </div>
        <div class="password-container">
            <input type="password" id="password" name="password" th:placeholder="#{password_placeholder}" oninput="validatePassword(); validateForm();">
            <button type="button" class="toggle-password" id="password-toggle" onclick="togglePasswordVisibility('password')">íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ ğŸ”’</button>
            <div class="password-requirements" th:text="#{password_requirements}">íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•œ 8~16ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
        </div>
        <br>
        <div class="password-container">
            <input type="password" id="confirm_password" name="confirm_password" th:placeholder="#{passwordcheck_placeholder}" oninput="validatePassword(); validateForm();">
            <button type="button" class="toggle-password" id="confirm_password-toggle" onclick="togglePasswordVisibility('confirm_password')">íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ ğŸ”’</button>
            <div id="password-error" class="error-message"></div>
        </div>
        <div class="terms-container">
            <input type="checkbox" id="terms" name="terms" onclick="validateForm()" required>
            <label style="padding-right: 20px;" for="terms" th:text="#{terms}">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™œìš© ë™ì˜</label>
            <button type="button" onclick="viewTerms()" th:text="#{view_terms}">ì•½ê´€ë³´ê¸°</button>
        </div>
        <div class="terms-container">
            <input type="checkbox" id="email_opt_in" name="email_opt_in">
            <label for="email_opt_in" th:text="#{optional}">(ì„ íƒ) ì´ë©”ì¼ ì•Œë¦¼ ì„œë¹„ìŠ¤ ìˆ˜ì‹  ë™ì˜</label>
        </div>
        <div>
            <button type="submit" th:text="#{signup}" disabled>ê°€ì…í•˜ê¸°</button>
        </div>
    </form>
    <p th:text="#{have_account}">
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="login.html">ë¡œê·¸ì¸</a>
    </p>
</div>

<div id="terms-modal">
    <div id="terms-modal-content">
        <span id="close-terms" onclick="closeTerms()">&times;</span>
        <h3 th:text="#{terms_modal_title}">OBservator ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</h3>
        <div>
            <p th:text="#{terms_last_updated}">ìµœì¢… ìˆ˜ì •ì¼: [2024-11-21]</p>
            <p th:text="#{terms_intro}">
                ë³¸ ì´ìš©ì•½ê´€(ì´í•˜ "ì•½ê´€")ì€ OBservator ì„œë¹„ìŠ¤(ì´í•˜ "ì„œë¹„ìŠ¤")ë¥¼ ì œê³µí•˜ëŠ” í–‰ë³µí•´ì¡° (ì´í•˜ "ìš´ì˜íŒ€")ê³¼
                ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì‚¬ìš©ì(ì´í•˜ "ì‚¬ìš©ì") ê°„ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì„ ê·œì •í•©ë‹ˆë‹¤.
            </p>
            <p th:text="#{terms_purpose}">
                ë³¸ ì„œë¹„ìŠ¤ëŠ” ë™êµ­ëŒ€í•™êµ ìœµí•©ìº¡ìŠ¤í†¤ë””ìì¸ì˜ í•™ìŠµ í”„ë¡œì íŠ¸ë¡œ, ìƒì—…ì  ëª©ì ì´ ì—†ëŠ” ì—°êµ¬ ëª©ì ìœ¼ë¡œë§Œ ì œê³µë©ë‹ˆë‹¤.
            </p>
            <h4 th:text="#{terms_section1_title}">1. ì„œë¹„ìŠ¤ ê°œìš”</h4>
            <ul>
                <li th:text="#{terms_section1_point1}">ë³¸ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ìë¡œë¶€í„° ì œê³µë°›ì€ Upbit API í‚¤ë¥¼ í†µí•´ ë¹„íŠ¸ì½”ì¸ ë§¤ë§¤ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
                <li th:text="#{terms_section1_point2}">ì„œë¹„ìŠ¤ëŠ” ì—°êµ¬ ë° í•™ìŠµ ëª©ì ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, íŠ¹ì • íˆ¬ì ì„±ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
            </ul>
            <h4 th:text="#{terms_section2_title}">2. API í‚¤ ë° ê°œì¸ ì •ë³´</h4>
            <ul>
                <li th:text="#{terms_section2_point1}">ì‚¬ìš©ìëŠ” Upbitì—ì„œ ìƒì„±í•œ API í‚¤ë¥¼ ì œê³µí•˜ë©°, ìš´ì˜íŒ€ì€ ì´ë¥¼ ì˜¤ì§ ì—°êµ¬ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
                <li th:text="#{terms_section2_point2}">í”„ë¡œì íŠ¸ ì¢…ë£Œ ì‹œ ì œê³µëœ ëª¨ë“  ì •ë³´ëŠ” ì‚­ì œë©ë‹ˆë‹¤.</li>
            </ul>
            <h4 th:text="#{terms_section3_title}">3. ì„œë¹„ìŠ¤ ì´ìš© ì¡°ê±´</h4>
            <ul>
                <li th:text="#{terms_section3_point1}">ë§Œ 18ì„¸ ì´ìƒì´ë©°, ì‚¬ìš©ìëŠ” ì„œë¹„ìŠ¤ê°€ ì‹¤í—˜ì ì„ì„ ì´í•´í•˜ê³  ì´ë¥¼ ìˆ˜ë½í•´ì•¼ í•©ë‹ˆë‹¤.</li>
                <li th:text="#{terms_section3_point2}">ì„œë¹„ìŠ¤ ì‚¬ìš©ìœ¼ë¡œ ë°œìƒí•œ ìì‚° ì†ì‹¤ì— ëŒ€í•´ ìš´ì˜íŒ€ì€ ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
            </ul>
            <h4 th:text="#{terms_section4_title}">4. ë°ì´í„° ë³´ìœ  ë° ì‚­ì œ</h4>
            <ul>
                <li th:text="#{terms_section4_point1}">ëª¨ë“  ë°ì´í„°ëŠ” ì•”í˜¸í™”í•˜ì—¬ ë³´ê´€í•˜ë©°, í”„ë¡œì íŠ¸ ì¢…ë£Œ ì‹œ ì¦‰ì‹œ ì‚­ì œí•©ë‹ˆë‹¤.</li>
            </ul>
            <h4 th:text="#{terms_section5_title}">5. ê¸°íƒ€</h4>
            <ul>
                <li th:text="#{terms_section5_point1}">ì„œë¹„ìŠ¤ëŠ” ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œê³µë˜ë©°, ìƒì—…ì  ì´ìš©ì„ ìœ„í•œ ì•ˆì •ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                <li th:text="#{terms_section5_point2}">ë¬¸ì˜ì‚¬í•­ì´ ìˆì„ ê²½ìš° observatoremail@gmail.comë¡œ ì—°ë½ ë°”ëë‹ˆë‹¤.</li>
            </ul>
            <p th:text="#{terms_disclaimer}">
                * ë™ì˜ë¥¼ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ê±°ë¶€ ì‹œ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            </p>
        </div>
    </div>
</div>
<script>
    let isUsernameChecked = false;

    function viewTerms() {
        var modal = document.getElementById("terms-modal");
        modal.style.display = "block";
    }

    function closeTerms() {
        var modal = document.getElementById("terms-modal");
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        var modal = document.getElementById("terms-modal");
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function togglePasswordVisibility(inputId) {
        var passwordInput = document.getElementById(inputId);
        var toggleButton = document.getElementById(inputId + "-toggle");
        if (passwordInput.type === "password") {
            passwordInput.type = "text";
            toggleButton.textContent = "ğŸ”“";
        } else {
            passwordInput.type = "password";
            toggleButton.textContent = "ğŸ”’";
        }
    }

    function validatePassword() {
        var password = document.getElementById("password").value;
        var confirmPassword = document.getElementById("confirm_password").value;
        var passwordError = document.getElementById("password-error");
        var submitButton = document.querySelector("button[type='submit']");
        var termsChecked = document.getElementById("terms").checked;

        if (password.length < 8 || password.length > 16 || !/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
            passwordError.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ì—¬ 8~16ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            submitButton.disabled = true;
        } else if (confirmPassword !== password) {
            passwordError.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            submitButton.disabled = true;
        } else {
            passwordError.textContent = "";
            submitButton.disabled = !termsChecked;
        }
    }

    function validateForm() {
        var password = document.getElementById("password").value;
        var confirmPassword = document.getElementById("confirm_password").value;
        var termsChecked = document.getElementById("terms").checked;
        var emailLocal = document.getElementById("email_local").value;
        var emailDomain = document.getElementById("email_domain").value;
        var emailDomainCustom = document.getElementById("email_domain_custom").value;
        var submitButton = document.querySelector("button[type='submit']");
        var isCustomDomain = emailDomain === "custom";
        var emailValid = emailLocal !== "" && (isCustomDomain ? emailDomainCustom !== "" : emailDomain !== "");
        if (password.length >= 8 && password.length <= 16 && /[!@#$%^&*(),.?":{}|<>]/.test(password) 
            && confirmPassword === password && termsChecked && emailValid && isUsernameChecked) {
            submitButton.disabled = false;
        } else {
            submitButton.disabled = true;
        }
    }
    
    function handleEmailDomainChange() {
        var emailDomainSelect = document.getElementById("email_domain");
        var emailDomainInput = document.getElementById("email_domain_custom");
        if (emailDomainSelect.value === "custom") {
            emailDomainInput.style.display = "inline-block";
            emailDomainInput.value = "";
        } else {
            emailDomainInput.style.display = "none";
            emailDomainInput.value = emailDomainSelect.value;
        }
        validateForm();
    }

    function checkUsername() {
        var username = document.getElementById("username").value;
        var usernameError = document.getElementById("username-error");
        var submitButton = document.querySelector("button[type='submit']");
        
        if (username === "") {
            usernameError.textContent = "ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            return;
        }
        
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/check-username", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    try {
                        var response = JSON.parse(xhr.responseText);
                        usernameError.textContent = response.message;
                        if (!response.exists) {
                            alert("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");
                            document.getElementById("username").readOnly = true;
                            document.getElementById("check-username-btn").disabled = true;
                            isUsernameChecked = true;
                            validateForm();
                        } else {
                            isUsernameChecked = false;
                        }
                    } catch (error) {
                        console.error("Error parsing JSON:", error);
                        usernameError.textContent = "ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
                        isUsernameChecked = false;
                    }
                } else {
                    usernameError.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                    isUsernameChecked = false;
                }
                validateForm();
            }
        };
        xhr.send(JSON.stringify({ username: username }));
    }
</script>
</body>
</html>

