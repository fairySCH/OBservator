<!DOCTYPE html>
<html>
<head>
    <title>Signup</title>
    <link rel="stylesheet" href="/css/signup.css">
    <script>
        let isUsernameChecked = false;
    
        function viewTerms() {
            var modal = document.getElementById("terms-modal");
            modal.style.display = "block";
        }
    
        function closeTerms() {
            var modal = document.getElementById("terms-modal");
            modal.style.display = "none";
        }
    
        window.onclick = function(event) {
            var modal = document.getElementById("terms-modal");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    
        function togglePasswordVisibility(inputId) {
            var passwordInput = document.getElementById(inputId);
            var toggleButton = document.getElementById(inputId + "-toggle");
            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                toggleButton.textContent = "ğŸ”“";
            } else {
                passwordInput.type = "password";
                toggleButton.textContent = "ğŸ”’";
            }
        }
    
        function validatePassword() {
            var password = document.getElementById("password").value;
            var confirmPassword = document.getElementById("confirm_password").value;
            var passwordError = document.getElementById("password-error");
            var submitButton = document.querySelector("button[type='submit']");
            var termsChecked = document.getElementById("terms").checked;
    
            if (password.length < 8 || password.length > 16 || !/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
                passwordError.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ì—¬ 8~16ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                submitButton.disabled = true;
            } else if (confirmPassword !== password) {
                passwordError.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
                submitButton.disabled = true;
            } else {
                passwordError.textContent = "";
                submitButton.disabled = !termsChecked;
            }
        }
    
        function validateForm() {
            var password = document.getElementById("password").value;
            var confirmPassword = document.getElementById("confirm_password").value;
            var termsChecked = document.getElementById("terms").checked;
            var emailLocal = document.getElementById("email_local").value;
            var emailDomain = document.getElementById("email_domain").value;
            var emailDomainCustom = document.getElementById("email_domain_custom").value;
            var submitButton = document.querySelector("button[type='submit']");
            var isCustomDomain = emailDomain === "custom";
            var emailValid = emailLocal !== "" && (isCustomDomain ? emailDomainCustom !== "" : emailDomain !== "");
            if (password.length >= 8 && password.length <= 16 && /[!@#$%^&*(),.?":{}|<>]/.test(password) 
                && confirmPassword === password && termsChecked && emailValid && isUsernameChecked) {
                submitButton.disabled = false;
            } else {
                submitButton.disabled = true;
            }
        }
        
        function handleEmailDomainChange() {
            var emailDomainSelect = document.getElementById("email_domain");
            var emailDomainInput = document.getElementById("email_domain_custom");
            if (emailDomainSelect.value === "custom") {
                emailDomainInput.style.display = "inline-block";
                emailDomainInput.value = "";
            } else {
                emailDomainInput.style.display = "none";
                emailDomainInput.value = emailDomainSelect.value;
            }
            validateForm();
        }
    
        function checkUsername() {
            var username = document.getElementById("username").value;
            var usernameError = document.getElementById("username-error");
            var submitButton = document.querySelector("button[type='submit']");
            
            if (username === "") {
                usernameError.textContent = "ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                return;
            }
            
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/check-username", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            var response = JSON.parse(xhr.responseText);
                            usernameError.textContent = response.message;
                            if (!response.exists) {
                                alert("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");
                                document.getElementById("username").readOnly = true;
                                document.getElementById("check-username-btn").disabled = true;
                                isUsernameChecked = true;
                                validateForm();
                            } else {
                                isUsernameChecked = false;
                            }
                        } catch (error) {
                            console.error("Error parsing JSON:", error);
                            usernameError.textContent = "ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
                            isUsernameChecked = false;
                        }
                    } else {
                        usernameError.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                        isUsernameChecked = false;
                    }
                    validateForm();
                }
            };
            xhr.send(JSON.stringify({ username: username }));
        }
    </script>
</head>
<body>
<div class="signup-container">
    <h2>íšŒì›ê°€ì…</h2>
    <p th:if="${errorMessage}" style="color:red;">[[${errorMessage}]]</p>
    <p th:if="${successMessage}" style="color:green;">[[${successMessage}]]</p>
    <form action="/signup" method="post">
        <div style="display: flex; align-items: center;">
            <input type="text" id="username" name="username" placeholder="ì•„ì´ë””" style="flex: 1;">
            <button type="button" id="check-username-btn" onclick="checkUsername()">ì¤‘ë³µí™•ì¸</button>
        </div>
        <div id="username-error" class="error-message"></div>
        <div class="username-requirements">íŠ¹ìˆ˜ë¬¸ì ì—†ì´ 4ì~20ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.(ì¤‘ë³µí™•ì¸ í•„ìˆ˜)</div>
        <div style="display: flex; align-items: center;">
            <input type="text" id="email_local" name="email_local" placeholder="ì´ë©”ì¼" style="width: 50%; margin-right: 5px;" oninput="validateForm();"> @ 
            <select id="email_domain" name="email_domain" style="width: 50%; margin-left: 5px;" onchange="handleEmailDomainChange();">
                <option value="">ë„ë©”ì¸ ì„ íƒ</option>
                <option value="naver.com">naver.com</option>
                <option value="gmail.com">gmail.com</option>
                <option value="daum.net">daum.net</option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
            </select>
            <input type="text" id="email_domain_custom" name="email_domain_custom" placeholder="ì§ì ‘ ì…ë ¥" style="display: none; width: 50%; margin-left: 5px;" oninput="validateForm();">
        </div>
        <div class="contact-container">
            <label for="phone1">ì—°ë½ì²˜: </label>
            <input type="text" id="phone1" name="phone1" value="010" readonly style="width: 50px;"> -
            <input type="text" id="phone2" name="phone2" maxlength="4" style="width: 60px;"> -
            <input type="text" id="phone3" name="phone3" maxlength="4" style="width: 60px;">
        </div>
        <div class="password-container">
            <input type="password" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" oninput="validatePassword(); validateForm();">
            <button type="button" class="toggle-password" id="password-toggle" onclick="togglePasswordVisibility('password')">ğŸ”’</button>
            <div class="password-requirements">íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•œ 8~16ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
        </div>
        <div class="password-container">
            <input type="password" id="confirm_password" name="confirm_password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" oninput="validatePassword(); validateForm();">
            <button type="button" class="toggle-password" id="confirm_password-toggle" onclick="togglePasswordVisibility('confirm_password')">ğŸ”’</button>
            <div id="password-error" class="error-message"></div>
        </div>
        <div class="terms-container">
            <input type="checkbox" id="terms" name="terms" onclick="validateForm()" required>
            <label for="terms">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™œìš© ë™ì˜</label>
            <button type="button" onclick="viewTerms()">ì•½ê´€ë³´ê¸°</button>
        </div>
        <div class="terms-container">
            <input type="checkbox" id="email_opt_in" name="email_opt_in">
            <label for="email_opt_in">(ì„ íƒ) ì´ë©”ì¼ ì•Œë¦¼ ì„œë¹„ìŠ¤ ìˆ˜ì‹  ë™ì˜</label>
        </div>
        <div>
            <button type="submit" disabled>ê°€ì…í•˜ê¸°</button>
        </div>
    </form>
    <p>
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="login.html">ë¡œê·¸ì¸</a>
    </p>
</div>

<div id="terms-modal">
    <div id="terms-modal-content">
        <span id="close-terms" onclick="closeTerms()">&times;</span>
        <h3>OBservator ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</h3>
        <div>
            <p>ìµœì¢… ìˆ˜ì •ì¼: [2024-11-21]</p>
            <p>
                ë³¸ ì´ìš©ì•½ê´€(ì´í•˜ "ì•½ê´€")ì€ OBservator ì„œë¹„ìŠ¤(ì´í•˜ "ì„œë¹„ìŠ¤")ë¥¼ ì œê³µí•˜ëŠ” í–‰ë³µí•´ì¡° (ì´í•˜ "ìš´ì˜íŒ€")ê³¼ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì‚¬ìš©ì(ì´í•˜ "ì‚¬ìš©ì") ê°„ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì„ ê·œì •í•©ë‹ˆë‹¤. 
                ë³¸ ì„œë¹„ìŠ¤ëŠ” ë™êµ­ëŒ€í•™êµ ìœµí•©ìº¡ìŠ¤í†¤ë””ìì¸ì˜ í•™ìŠµ í”„ë¡œì íŠ¸ë¡œ, ìƒì—…ì  ëª©ì ì´ ì—†ëŠ” ì—°êµ¬ ëª©ì ìœ¼ë¡œë§Œ ì œê³µë©ë‹ˆë‹¤.
            </p>
            <h4>1. ì„œë¹„ìŠ¤ ê°œìš”</h4>
            <ul>
                <li>ë³¸ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ìë¡œë¶€í„° ì œê³µë°›ì€ Upbit API í‚¤ë¥¼ í†µí•´ ë¹„íŠ¸ì½”ì¸ ë§¤ë§¤ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
                <li>ì„œë¹„ìŠ¤ëŠ” ì—°êµ¬ ë° í•™ìŠµ ëª©ì ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, íŠ¹ì • íˆ¬ì ì„±ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
            </ul>
            <h4>2. API í‚¤ ë° ê°œì¸ ì •ë³´</h4>
            <ul>
                <li>ì‚¬ìš©ìëŠ” Upbitì—ì„œ ìƒì„±í•œ API í‚¤ë¥¼ ì œê³µí•˜ë©°, ìš´ì˜íŒ€ì€ ì´ë¥¼ ì˜¤ì§ ì—°êµ¬ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
                <li>í”„ë¡œì íŠ¸ ì¢…ë£Œ ì‹œ ì œê³µëœ ëª¨ë“  ì •ë³´ëŠ” ì‚­ì œë©ë‹ˆë‹¤.</li>
            </ul>
            <h4>3. ì„œë¹„ìŠ¤ ì´ìš© ì¡°ê±´</h4>
            <ul>
                <li>ë§Œ 18ì„¸ ì´ìƒì´ë©°, ì‚¬ìš©ìëŠ” ì„œë¹„ìŠ¤ê°€ ì‹¤í—˜ì ì„ì„ ì´í•´í•˜ê³  ì´ë¥¼ ìˆ˜ë½í•´ì•¼ í•©ë‹ˆë‹¤.</li>
                <li>ì„œë¹„ìŠ¤ ì‚¬ìš©ìœ¼ë¡œ ë°œìƒí•œ ìì‚° ì†ì‹¤ì— ëŒ€í•´ ìš´ì˜íŒ€ì€ ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
            </ul>
            <h4>4. ë°ì´í„° ë³´ìœ  ë° ì‚­ì œ</h4>
            <ul>
                <li>ëª¨ë“  ë°ì´í„°ëŠ” ì•”í˜¸í™”í•˜ì—¬ ë³´ê´€í•˜ë©°, í”„ë¡œì íŠ¸ ì¢…ë£Œ ì‹œ ì¦‰ì‹œ ì‚­ì œí•©ë‹ˆë‹¤.</li>
            </ul>
            <h4>5. ê¸°íƒ€</h4>
            <ul>
                <li>ì„œë¹„ìŠ¤ëŠ” ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œê³µë˜ë©°, ìƒì—…ì  ì´ìš©ì„ ìœ„í•œ ì•ˆì •ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                <li>ë¬¸ì˜ì‚¬í•­ì´ ìˆì„ ê²½ìš° observatoremail@gmail.comë¡œ ì—°ë½ ë°”ëë‹ˆë‹¤.</li>
            </ul>
            <p>
                * ë™ì˜ë¥¼ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ê±°ë¶€ ì‹œ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                * ë³¸ ì•½ê´€ì€ í–‰ë³µí•´ì¡°ì˜ í•™ìŠµ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
            </p>
        </div>
    </div>
</div>
</body>
</html>

